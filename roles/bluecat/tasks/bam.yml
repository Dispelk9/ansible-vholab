---
#- name: Show bam_tar variable
#  debug:
#    var: bam_tar
- name: Unpack BAM tarball into images dir
  unarchive:
    src:   "{{ bam_tar }}"
    dest:  "{{ base_dir }}"
    remote_src: yes
    creates:    "{{ base_dir }}/{{bam_qcow}}"
  become: yes

- name: Copy image to libvirt
  ansible.builtin.copy:
    src: "{{ base_dir }}/{{bam_qcow}}"
    dest: "{{ images_dir }}/{{bam_qcow}}"
    force: yes

- name: Define the BAM domain
  community.libvirt.virt:
    name: proteus
    command: define
    xml:  "{{ lookup('template', 'bam-9.6.0-template.xml.j2') }}"
    autostart: true
  become: yes

- name: Start the BAM domain
  community.libvirt.virt:
    name: proteus
    state: running
  become: yes

